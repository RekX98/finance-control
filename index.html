<!doctype html>
<html lang="uk">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Фінансовий контроль</title>

<style>
body{font-family:system-ui;background:#f4f6fb;margin:0}
main{max-width:900px;margin:auto;padding:16px}
.box{background:#fff;border-radius:14px;padding:16px;margin:14px 0}
label{font-weight:700;display:block;margin-top:10px}
input,select{width:100%;padding:10px;margin-top:4px}
button{margin-top:12px;padding:12px 16px;font-weight:800}
.result{display:none;background:#eaf2ff;padding:14px;border-left:5px solid #1f5bff}
canvas{width:100%;height:220px;background:#fff;margin-top:12px}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{border-bottom:1px solid #ddd;padding:8px;text-align:center}
.hint{font-size:13px;margin-top:6px}
</style>
</head>

<body>
<main>

<div class="box">
<label>Сума</label>
<input id="sum" type="number">

<label>%</label>
<input id="percent" type="number">

<label>Період</label>
<select id="rateType">
<option value="month">% / місяць</option>
<option value="year">% / рік</option>
</select>

<label>Місяців</label>
<input id="months" type="number">

<button onclick="calculate()">Порахувати</button>
</div>

<div id="result" class="box result">
<div id="warning" class="hint"></div>

<p><b>Всього:</b> <span id="total"></span></p>
<p><b>Переплата:</b> <span id="overpay"></span></p>
<p><b>Місячний:</b> <span id="monthly"></span></p>

<canvas id="chart"></canvas>

<table>
<thead>
<tr><th>Міс</th><th>%</th><th>Платіж</th><th>Залишок</th></tr>
</thead>
<tbody id="tableBody"></tbody>
</table>
</div>

</main>

<script>
const sumEl = document.getElementById('sum')
const percentEl = document.getElementById('percent')
const rateTypeEl = document.getElementById('rateType')
const monthsEl = document.getElementById('months')

const totalEl = document.getElementById('total')
const overpayEl = document.getElementById('overpay')
const monthlyEl = document.getElementById('monthly')
const tableBody = document.getElementById('tableBody')
const resultBox = document.getElementById('result')
const warningEl = document.getElementById('warning')
const chart = document.getElementById('chart')

function getRate(){
  const p = Number(percentEl.value)
  return rateTypeEl.value === 'year' ? p/100/12 : p/100
}

function fmt(n){ return n.toFixed(2) }

function calculate(){
  const sum = Number(sumEl.value)
  const months = Number(monthsEl.value)
  const r = getRate()

  if(!sum || !months){
    alert('Заповніть всі поля')
    return
  }

  tableBody.innerHTML = ''
  let balance = sum
  let total = 0
  let chartData = []

  const monthly = r === 0
    ? sum / months
    : sum * r / (1 - Math.pow(1+r, -months))

  for(let i=1;i<=months;i++){
    const interest = balance * r
    let principal = monthly - interest
    if(principal > balance) principal = balance

    balance -= principal
    if(balance < 0.01) balance = 0

    total += principal + interest
    chartData.push(balance)

    tableBody.innerHTML += `
      <tr>
        <td>${i}</td>
        <td>${fmt(interest)}</td>
        <td>${fmt(principal+interest)}</td>
        <td>${fmt(balance)}</td>
      </tr>`
  }

  totalEl.textContent = fmt(total)
  overpayEl.textContent = fmt(total - sum)
  monthlyEl.textContent = fmt(monthly)

  warningEl.textContent =
    r >= 0.3 ? '⚠️ Кабальний %' :
    r >= 0.05 ? '❗ Високий %' :
    '✅ Нормальний %'

  drawChart(chartData)
  resultBox.style.display = 'block'
}

function drawChart(data){
  const ctx = chart.getContext('2d')
  chart.width = chart.offsetWidth
  chart.height = 220
  ctx.clearRect(0,0,chart.width,chart.height)

  const max = Math.max(...data)
  const step = chart.width/(data.length-1)

  ctx.beginPath()
  data.forEach((v,i)=>{
    const x = i*step
    const y = chart.height - (v/max)*chart.height
    i===0 ? ctx.moveTo(x,y) : ctx.lineTo(x,y)
  })
  ctx.strokeStyle = '#1f5bff'
  ctx.lineWidth = 3
  ctx.stroke()
}
</script>
</body>
</html>
