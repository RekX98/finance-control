<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å ‚Äî –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</title>
  <meta name="description" content="–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∏–π –∫—Ä–µ–¥–∏—Ç–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä: –∞–Ω—É—ó—Ç–µ—Ç —ñ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π –ø–ª–∞—Ç—ñ–∂, –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –Ω–∞ –≥—Ä–∞—Ñ—ñ–∫—É, —Ç–∞–±–ª–∏—Ü—è –ø–ª–∞—Ç–µ–∂—ñ–≤, –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ —Ç–∞ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ –∫–∞–±–∞–ª—å–Ω—ñ –≤—ñ–¥—Å–æ—Ç–∫–∏. –ë–µ–∑ —Ä–µ–∫–ª–∞–º–∏ —Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó." />
  <meta name="keywords" content="–∫—Ä–µ–¥–∏—Ç–Ω–∏–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä, –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫—Ä–µ–¥–∏—Ç—É, –∞–Ω—É—ó—Ç–µ—Ç, –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π –ø–ª–∞—Ç—ñ–∂, –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –ø–æ –∫—Ä–µ–¥–∏—Ç—É, –≥—Ä–∞—Ñ—ñ–∫ –±–æ—Ä–≥—É, –ø–ª–∞—Ç–µ–∂—ñ" />
  <link rel="icon" href="/favicon.svg" type="image/svg+xml">


  <style>
    :root{
      --blue:#1f5bff;
      --bg:#f4f6fb;
      --card:#ffffff;
      --tine:#e5e7eb;
      --danger:#dc2626;
      --warn:#b45309;
      --ok:#16a34a;
    
      --text:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    header{
      background:linear-gradient(135deg,#1f5bff,#3b82f6);
      color:#fff;
      padding:28px 16px;
      text-align:center;
    }
    header h1{margin:0;font-size:30px;font-weight:900}
    header p{margin:8px 0 0;opacity:.9}

    main{max-width:1100px;margin:0 auto;padding:16px}
    .box{
      background:var(--card);
      border-radius:18px;
      padding:20px;
      box-shadow:0 14px 35px rgba(15,23,42,.08);
      margin:14px 0;
    }

    label{display:block;margin:10px 0 6px;font-weight:900}
    input,select{
      width:100%;
      padding:12px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      font-size:16px;
      background:#fff;
      outline:none;
    }
    input:focus,select:focus{
      border-color:rgba(31,91,255,.65);
      box-shadow:0 0 0 4px rgba(31,91,255,.12);
    }

    .row{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
    }
    @media (max-width:720px){
      .row{grid-template-columns:1fr}
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    button{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:12px 16px;
      border:none;
      border-radius:14px;
      font-size:15px;
      font-weight:900;
      cursor:pointer;
      background:var(--blue);
      color:#fff;
    }
    button:active{transform:translateY(1px)}
    button.light{
      background:#eaf2ff;
      color:#0f172a;
      border:1px solid rgba(15,23,42,.10);
    }
    button.secondary{background:#0f172a}
    button.danger{background:var(--danger)}

    .hint{font-size:13px;color:var(--muted);margin-top:6px;line-height:1.35}

    .result-box{
      display:none;
      margin-top:14px;
      background:#eaf2ff;
      border-left:8px solid var(--blue);
      border-radius:16px;
      padding:16px;
    }
    .result-line{
      font-size:18px;
      margin:10px 0;
      font-weight:900;
    }
    .badge{
      display:inline-block;
      padding:4px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      margin-left:8px;
      background:#fff;
      border:1px solid rgba(15,23,42,.12);
      color:#0f172a;
      vertical-align:middle;
    }
    .badge.danger{color:var(--danger);border-color:rgba(220,38,38,.35)}
    .badge.warn{color:var(--warn);border-color:rgba(180,83,9,.35)}
    .badge.ok{color:var(--ok);border-color:rgba(22,163,74,.35)}

    .chartWrap{
      margin-top:10px;
      background:#fff;
      border:1px solid rgba(15,23,42,.08);
      border-radius:14px;
      padding:10px;
    }
    #chart{
      width:100%;
      height:260px;
      display:block;
    }
    .legend{
      display:flex;
      gap:14px;
      flex-wrap:wrap;
      margin:8px 0 0;
      font-size:13px;
      color:var(--muted);
      font-weight:800;
    }
    .dot{width:10px;height:10px;border-radius:999px;display:inline-block;margin-right:6px;vertical-align:middle}
    .dot.blue{background:#1f5bff}
    .dot.green{background:#16a34a}

    .tableWrap{
      margin-top:14px;
      overflow:auto;
      border-radius:14px;
      border:1px solid rgba(15,23,42,.08);
      background:#fff;
    }
    table{
      width:100%;
      border-collapse:collapse;
      min-width:560px;
    }
    th,td{
      padding:12px 10px;
      border-bottom:1px solid var(--line);
      text-align:center;
      font-variant-numeric: tabular-nums;
      white-space:nowrap;
    }
    th{background:#f1f5ff;font-weight:900}
    tr:nth-child(even) td{background:#fafbff}
    tr:last-child td{border-bottom:none}

    .savedBox{
      display:none;
      margin-top:14px;
      background:#fff;
      border:1px solid rgba(15,23,42,.10);
      border-radius:16px;
      padding:14px;
    }
    .savedHeader{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .savedHeader h3{margin:0}
    .savedList{display:grid;gap:10px;margin-top:10px}
    .savedItem{
      border:1px solid rgba(15,23,42,.10);
      border-radius:14px;
      padding:12px;
      background:#fafbff;
    }
    .savedItem .top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-weight:900;
    }
    .savedItem .meta{
      margin-top:6px;
      color:var(--muted);
      font-size:13px;
      line-height:1.35;
    }
    .savedItem .btns{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }

    @media print{
      header, .actions, #savedBox, .hint { display:none !important; }
      body{background:#fff}
      .box{box-shadow:none;border:1px solid #ddd}
      #result{display:block !important}
      .tableWrap{overflow:visible}
      table{min-width:auto}
    }
  
    /* Top navigation */
    .topbar{
      position:sticky;
      top:0;
      z-index:50;
      background:linear-gradient(135deg,#1f5bff,#3b82f6);
      color:#fff;
      padding:14px 16px;
    }
    .topbar-inner{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }
    .logo{
      font-weight:900;
      letter-spacing:.2px;
      font-size:18px;
    }
    .menu{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .menu a{
      color:#fff;
      text-decoration:none;
      font-weight:900;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.25);
      background:rgba(255,255,255,.10);
    }
    .menu a:hover{background:rgba(255,255,255,.18)}

  </style>
</head>

<body>
  
  <header class="topbar">
    <div class="topbar-inner">
      <div class="logo">–§—ñ–Ω–∞–Ω—Å–æ–≤–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å</div>
      <nav class="menu">
        <a href="credit-guide.html">–Ø–∫ —Ä–∞—Ö—É–≤–∞—Ç–∏</a>
        <a href="faq.html">FAQ</a>
      </nav>
    </div>
  </header>

<main>
    <div class="box">
      <h2>–ù–∞–≤—ñ—â–æ —Ü–µ–π –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä</h2>
  <p>
    –¶–µ–π —Å–µ—Ä–≤—ñ—Å –¥–æ–ø–æ–º–∞–≥–∞—î —à–≤–∏–¥–∫–æ –ø–æ—Ä–∞—Ö—É–≤–∞—Ç–∏ —Ä–µ–∞–ª—å–Ω—É –≤–∞—Ä—Ç—ñ—Å—Ç—å –∫—Ä–µ–¥–∏—Ç—É:
    —Å–∫—ñ–ª—å–∫–∏ –≤–∏ –∑–∞–ø–ª–∞—Ç–∏—Ç–µ –∑–∞–≥–∞–ª–æ–º, —è–∫—É –ø–µ—Ä–µ–ø–ª–∞—Ç—É –º–∞—î—Ç–µ —Ç–∞ —è–∫ –∑–º—ñ–Ω—é—î—Ç—å—Å—è –±–æ—Ä–≥
    —â–æ–º—ñ—Å—è—Ü—è.
  </p>
  <ul>
    <li>‚úî –∞–Ω—É—ó—Ç–µ—Ç–Ω—ñ —Ç–∞ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω—ñ –ø–ª–∞—Ç–µ–∂—ñ</li>
    <li>‚úî –Ω–∞–æ—á–Ω–∏–π –≥—Ä–∞—Ñ—ñ–∫ –±–æ—Ä–≥—É</li>
    <li>‚úî –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø—Ä–æ ¬´–∫–∞–±–∞–ª—å–Ω—ñ¬ª –≤—ñ–¥—Å–æ—Ç–∫–∏</li>
    <li>‚úî –±–µ–∑ —Ä–µ–∫–ª–∞–º–∏ —Ç–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó</li>
    <li>‚úî –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ —É –≤–∞—à–æ–º—É –±—Ä–∞—É–∑–µ—Ä—ñ</li>
  </ul>
</div>
    <div class="cta">
      <li>üëâ <a href="credit-without-scam.html">–ö—Ä–µ–¥–∏—Ç –±–µ–∑ –æ–±–º–∞–Ω—É ‚Äî –ø—Ä–∞–≤–¥–∞ –ø—Ä–æ –≤—ñ–¥—Å–æ—Ç–∫–∏ —Ç–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç—É</a></li>
      <li>üëâ <a href="online-credit-tips.html">–û–Ω–ª–∞–π–Ω –∫—Ä–µ–¥–∏—Ç: –Ω–∞ —â–æ –∑–≤–µ—Ä–Ω—É—Ç–∏ —É–≤–∞–≥—É –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è–º</a></li>
      <li>üëâ <a href="credit-0-percent.html">–ö—Ä–µ–¥–∏—Ç –ø—ñ–¥ 0% ‚Äî –ø—Ä–∞–≤–¥–∞ —á–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤–∏–π –æ–±–º–∞–Ω?</a></li>
    </div>
<li>
      <h2 style="margin:0 0 10px;font-size:24px;">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –±–æ—Ä–≥—É</h2>

      <label>–°—É–º–∞ –±–æ—Ä–≥—É</label>
      <input type="number" id="sum" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 10000" inputmode="numeric" />

      <label>–í–∞–ª—é—Ç–∞</label>
      <select id="currency">
        <option value="UAH" data-symbol="‚Ç¥">UAH ‚Ç¥</option>
        <option value="USD" data-symbol="$">USD $</option>
        <option value="EUR" data-symbol="‚Ç¨">EUR ‚Ç¨</option>
        <option value="PLN" data-symbol="z≈Ç">PLN z≈Ç</option>
      </select>


      <div class="row">
        <div>
          <label>–í—ñ–¥—Å–æ—Ç–æ–∫</label>
          <input type="number" id="percent" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 5 –∞–±–æ 55" inputmode="decimal" />
          <div class="hint">–í–≤–æ–¥—å —è–∫ —É –¥–æ–≥–æ–≤–æ—Ä—ñ. –Ø–∫—â–æ 55% –Ω–∞ –º—ñ—Å—è—Ü—å ‚Äî –æ–±–µ—Ä–∏ ‚Äú% –Ω–∞ –º—ñ—Å—è—Ü—å‚Äù.</div>
        </div>
        <div>
          <label>–ü–µ—Ä—ñ–æ–¥ –≤—ñ–¥—Å–æ—Ç–∫–∞</label>
          <select id="rateType">
            <option value="month">% –Ω–∞ –º—ñ—Å—è—Ü—å</option>
            <option value="year">% –Ω–∞ —Ä—ñ–∫</option>
          </select>
          <div class="hint">–Ø–∫—â–æ % –Ω–∞ —Ä—ñ–∫ ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–¥—ñ–ª–∏–º–æ –Ω–∞ 12.</div>
        </div>
      </div>

      <div class="row">
        <div>
          <label>–¢–µ—Ä–º—ñ–Ω (–º—ñ—Å—è—Ü—ñ–≤)</label>
          <input type="number" id="months" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: 12" inputmode="numeric" />
        </div>
        <div>
          <label>–¢–∞–±–ª–∏—Ü—è –¥–ª—è</label>
          <select id="tableType">
            <option value="annuity">–ê–Ω–Ω—É—ó—Ç–µ—Ç (—Ä—ñ–≤–Ω–∏–π –ø–ª–∞—Ç—ñ–∂)</option>
            <option value="diff">–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π (–ø–ª–∞—Ç—ñ–∂ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è)</option>
          </select>
          <div class="hint">–ì—Ä–∞—Ñ—ñ–∫ –∑–∞–≤–∂–¥–∏ –ø–æ–∫–∞–∑—É—î –æ–±–∏–¥–≤–∞ –≤–∞—Ä—ñ–∞–Ω—Ç–∏ –¥–ª—è –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è.</div>
        </div>
      </div>

      <div class="actions">
        <button type="button" id="btnCalc">üßÆ –ü–æ—Ä–∞—Ö—É–≤–∞—Ç–∏</button>
        <button type="button" class="light" id="btnDemo">‚ú® –î–µ–º–æ</button>
        <button type="button" class="light" id="btnClearForm">üßπ –û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º—É</button>
        <button type="button" class="secondary" id="btnToggleHistory">üìÇ –Ü—Å—Ç–æ—Ä—ñ—è</button>
      </div>

      <div id="result" class="result-box">
        <div id="rateWarning" class="result-line" style="font-size:16px;margin:0 0 10px;"></div>

        <div class="result-line">–ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: <span id="total">0.00</span> –≥—Ä–Ω <span id="badgeTotal" class="badge"></span></div>
        <div class="result-line">–ü–µ—Ä–µ–ø–ª–∞—Ç–∞: <span id="overpay">0.00</span> –≥—Ä–Ω <span id="badgeOver" class="badge"></span></div>
        <div class="result-line">–ü–ª–∞—Ç—ñ–∂ (–¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ): <span id="monthly">0.00</span> –≥—Ä–Ω</div>

        <h3 style="margin:18px 0 10px;">–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: –∑–∞–ª–∏—à–æ–∫ –±–æ—Ä–≥—É (2 –ª—ñ–Ω—ñ—ó)</h3>
        <div class="chartWrap">
          <canvas id="chart"></canvas>
          <div class="legend">
            <div><span class="dot blue"></span>–ê–Ω–Ω—É—ó—Ç–µ—Ç</div>
            <div><span class="dot green"></span>–î–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π</div>
          </div>
        </div>

        <h3 style="margin:18px 0 10px;">–ì—Ä–∞—Ñ—ñ–∫ –ø–ª–∞—Ç–µ–∂—ñ–≤ (—Ç–∞–±–ª–∏—Ü—è)</h3>
        <div class="tableWrap">
          <table id="paymentTable">
            <thead>
              <tr>
                <th>–ú—ñ—Å—è—Ü—å</th>
                <th>–í—ñ–¥—Å–æ—Ç–∫–∏</th>
                <th>–ü–ª–∞—Ç—ñ–∂</th>
                <th>–ó–∞–ª–∏—à–æ–∫</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <div class="actions" style="margin-top:12px;">
          <button type="button" id="btnSave">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
          <button type="button" class="light" id="btnExcel">üìä Excel</button>
          <button type="button" class="light" id="btnPrint">üñ®Ô∏è –î—Ä—É–∫</button>
        </div>

        <div class="hint" style="margin-top:10px;">
          –£–≤–∞–≥–∞: —Ü–µ —Å–ø—Ä–æ—â–µ–Ω–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫ (–±–µ–∑ –∫–æ–º—ñ—Å—ñ–π/—à—Ç—Ä–∞—Ñ—ñ–≤/—Å—Ç—Ä–∞—Ö–æ–≤–æ–∫).
        </div>
      </div>

      <div id="savedBox" class="savedBox">
        <div class="savedHeader">
          <h3>–ó–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏</h3>
          <div class="actions" style="margin:0;">
            <button type="button" class="light" id="btnExportHistoryCSV">‚¨áÔ∏è CSV</button>
            <button type="button" class="danger" id="btnClearHistory">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç–∏</button>
          </div>
        </div>
        <div id="savedList" class="savedList"></div>
        <div class="hint">–ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –ª–∏—à–µ –Ω–∞ —Ü—å–æ–º—É –ø—Ä–∏—Å—Ç—Ä–æ—ó (localStorage).</div>
      </div>

    </div>
  </main>

  <!-- libs -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  
<section id="faq" class="box">
  <button id="faqToggle" style="
    width:100%;
    text-align:left;
    background:#eaf2ff;
    border:1px solid rgba(15,23,42,.10);
    border-radius:14px;
    padding:14px 16px;
    font-size:18px;
    font-weight:900;
    cursor:pointer;
   color:#0f172a;">
    ‚ùì –ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –∫—Ä–µ–¥–∏—Ç
  </button>

  <div id="faqBody" style="display:none; margin-top:14px;">

  <h2>–ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –∫—Ä–µ–¥–∏—Ç</h2>

  <h3>–©–æ —Ç–∞–∫–µ –∞–Ω—É—ó—Ç–µ—Ç–Ω–∏–π –ø–ª–∞—Ç—ñ–∂?</h3>
  <p>
    –ê–Ω—É—ó—Ç–µ—Ç ‚Äî —Ü–µ —Å—Ö–µ–º–∞ –∫—Ä–µ–¥–∏—Ç—É, –ø—Ä–∏ —è–∫—ñ–π –≤–∏ —â–æ–º—ñ—Å—è—Ü—è –ø–ª–∞—Ç–∏—Ç–µ –æ–¥–Ω–∞–∫–æ–≤—É —Å—É–º—É.
    –ù–∞ –ø–æ—á–∞—Ç–∫—É –±—ñ–ª—å—à–∞ —á–∞—Å—Ç–∏–Ω–∞ –ø–ª–∞—Ç–µ–∂—É –π–¥–µ –Ω–∞ –≤—ñ–¥—Å–æ—Ç–∫–∏, –∞ —Ç—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É
    –∑–º–µ–Ω—à—É—î—Ç—å—Å—è –ø–æ–≤—ñ–ª—å–Ω–æ. –ó–∞–≥–∞–ª—å–Ω–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –∑–∞–∑–≤–∏—á–∞–π –±—ñ–ª—å—à–∞.
  </p>

  <h3>–©–æ —Ç–∞–∫–µ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π –ø–ª–∞—Ç—ñ–∂?</h3>
  <p>
    –ü—Ä–∏ –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–æ–º—É –ø–ª–∞—Ç–µ–∂—ñ —Ç—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É –¥—ñ–ª–∏—Ç—å—Å—è –Ω–∞ —Ä—ñ–≤–Ω—ñ —á–∞—Å—Ç–∏–Ω–∏,
    –∞ –≤—ñ–¥—Å–æ—Ç–∫–∏ –Ω–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –Ω–∞ –∑–∞–ª–∏—à–æ–∫ –±–æ—Ä–≥—É. –ü–µ—Ä—à—ñ –ø–ª–∞—Ç–µ–∂—ñ –±—ñ–ª—å—à—ñ,
    –∞–ª–µ –∑ –∫–æ–∂–Ω–∏–º –º—ñ—Å—è—Ü–µ–º —Å—É–º–∞ –∑–º–µ–Ω—à—É—î—Ç—å—Å—è. –ü–µ—Ä–µ–ø–ª–∞—Ç–∞ –∑–∞–∑–≤–∏—á–∞–π –º–µ–Ω—à–∞,
    –Ω—ñ–∂ –ø—Ä–∏ –∞–Ω—É—ó—Ç–µ—Ç—ñ.
  </p>

  <h3>–ß–æ–º—É –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –±—ñ–ª—å—à–æ—é –∑–∞ —Å—É–º—É –∫—Ä–µ–¥–∏—Ç—É?</h3>
  <p>
    –¶–µ —Ç—Ä–∞–ø–ª—è—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤–∏—Å–æ–∫—ñ –≤—ñ–¥—Å–æ—Ç–∫–æ–≤—ñ —Å—Ç–∞–≤–∫–∏ –∞–±–æ –¥–æ–≤–≥–∏–π —Ç–µ—Ä–º—ñ–Ω –∫—Ä–µ–¥–∏—Ç—É.
    –û—Å–æ–±–ª–∏–≤–æ —Ü–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–Ω–æ –¥–ª—è –º—ñ–∫—Ä–æ–∫—Ä–µ–¥–∏—Ç—ñ–≤ –∑ –≤—ñ–¥—Å–æ—Ç–∫–æ–º ‚Äú–Ω–∞ –¥–µ–Ω—å‚Äù –∞–±–æ ‚Äú–Ω–∞ –º—ñ—Å—è—Ü—å‚Äù.
  </p>

  <h3>–ß–∏ –≤—Ä–∞—Ö–æ–≤—É—î –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –∫–æ–º—ñ—Å—ñ—ó —Ç–∞ —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏?</h3>
  <p>
    –ù—ñ. –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø–æ–∫–∞–∑—É—î –±–∞–∑–æ–≤–∏–π —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫: —Ç—ñ–ª–æ –∫—Ä–µ–¥–∏—Ç—É —Ç–∞ –≤—ñ–¥—Å–æ—Ç–∫–∏.
    –ö–æ–º—ñ—Å—ñ—ó, —à—Ç—Ä–∞—Ñ–∏, —Å—Ç—Ä–∞—Ö–æ–≤–∫–∏ —Ç–∞ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–ª–∞—Ç–µ–∂—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏
    –æ–∫—Ä–µ–º–æ —É –¥–æ–≥–æ–≤–æ—Ä—ñ.
  </p>

  <h3>–Ø–∫–∏–π —Ç–∏–ø –ø–ª–∞—Ç–µ–∂—É –≤–∏–≥—ñ–¥–Ω—ñ—à–∏–π?</h3>
  <p>
    –Ø–∫—â–æ –≤–∞–∂–ª–∏–≤–∞ –º–µ–Ω—à–∞ –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ ‚Äî –∑–∞–∑–≤–∏—á–∞–π –≤–∏–≥—ñ–¥–Ω—ñ—à–∏–π –¥–∏—Ñ–µ—Ä–µ–Ω—Ü—ñ–π–æ–≤–∞–Ω–∏–π –ø–ª–∞—Ç—ñ–∂.
    –Ø–∫—â–æ –≤–∞–∂–ª–∏–≤–∞ —Å—Ç–∞–±—ñ–ª—å–Ω–∞ —Å—É–º–∞ —â–æ–º—ñ—Å—è—Ü—è ‚Äî –∞–Ω—É—ó—Ç–µ—Ç –∑—Ä—É—á–Ω—ñ—à–∏–π,
    –∞–ª–µ –¥–æ—Ä–æ–∂—á–∏–π —É –¥–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤—ñ–π –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ñ.
  </p>
  </div>
</section>


  <script>
    // ---------- DOM ----------
    const el = (id) => document.getElementById(id);

    const sumEl = el('sum');
    const percentEl = el('percent');
    const rateTypeEl = el('rateType');
    const monthsEl = el('months');
    const tableTypeEl = el('tableType');

    const resultBox = el('result');
    const rateWarning = el('rateWarning');
    const totalOut = el('total');
    const overpayOut = el('overpay');
    const monthlyOut = el('monthly');
    const badgeTotal = el('badgeTotal');
    const badgeOver = el('badgeOver');

    const tbody = document.querySelector('#paymentTable tbody');
    const chart = el('chart');

    const savedBox = el('savedBox');
    const savedList = el('savedList');

    // ---------- helpers ----------

    const currencyEl = el('currency');
    function cur(){
      const opt = currencyEl.options[currencyEl.selectedIndex];
      return opt ? opt.dataset.symbol : '‚Ç¥';
    }

    function fmt(n){
      if (!isFinite(n)) return '0.00';
      return (Math.round(n * 100) / 100).toFixed(2) + ' ' + cur();
    }
    function nowStr(){
      return new Date().toLocaleString();
    }

    function getMonthlyRate(){
      const percent = Number(percentEl.value);
      const rateType = rateTypeEl.value; // month|year
      if (!percent) return 0;
      return rateType === 'year' ? (percent/100)/12 : (percent/100);
    }

    function setBadge(badge, text, cls){
      badge.className = 'badge ' + (cls || '');
      badge.textContent = text || '';
    }

    function warnByRate(r){
      // r = monthly in decimals
      if (r >= 0.30) return {text:'‚ö†Ô∏è –ö–∞–±–∞–ª—å–Ω–∏–π %: –¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π –≤—ñ–¥—Å–æ—Ç–æ–∫', cls:'danger'};
      if (r >= 0.05) return {text:'‚ùó –í–∏—Å–æ–∫–∏–π %: –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ –º–æ–∂–µ –±—É—Ç–∏ –∑–Ω–∞—á–Ω–æ—é', cls:'warn'};
      if (r === 0) return {text:'‚úÖ 0%: –±–µ–∑ –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤', cls:'ok'};
      return {text:'‚úÖ –í—ñ–¥—Å–æ—Ç–æ–∫ —É –º–µ–∂–∞—Ö –Ω–æ—Ä–º–∏', cls:'ok'};
    }

    function addRow(month, interest, payment, balance){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${month}</td>
        <td>${fmt(interest)}</td>
        <td>${fmt(payment)}</td>
        <td>${fmt(balance)}</td>
      `;
      tbody.appendChild(tr);
    }

    // ---------- core calculations ----------
    function calcAnnuity(sum, months, r){
      // returns { scheduleRows, totalPaid, monthlyPay, balances[] }
      let balance = sum;
      let totalPaid = 0;
      const balances = [sum];
      const rows = [];

      let monthlyPay = 0;
      if (months <= 0) return {rows, totalPaid:0, monthlyPay:0, balances};

      if (r === 0){
        monthlyPay = sum / months;
      } else {
        monthlyPay = sum * r / (1 - Math.pow(1 + r, -months));
      }

      for (let i=1;i<=months;i++){
        const interest = balance * r;
        let principal = monthlyPay - interest;

        if (principal > balance) principal = balance;
        const payment = principal + interest;

        balance -= principal;
        if (balance < 0.01) balance = 0;

        totalPaid += payment;
        balances.push(balance);
        rows.push({i, interest, payment, balance});
      }

      return {rows, totalPaid, monthlyPay, balances};
    }

    function calcDiff(sum, months, r){
      let balance = sum;
      let totalPaid = 0;
      const balances = [sum];
      const rows = [];

      if (months <= 0) return {rows, totalPaid:0, firstPay:0, balances};

      const principalPart = sum / months;

      for (let i=1;i<=months;i++){
        const interest = balance * r;
        let principal = principalPart;
        if (principal > balance) principal = balance;

        const payment = principal + interest;

        balance -= principal;
        if (balance < 0.01) balance = 0;

        totalPaid += payment;
        balances.push(balance);
        rows.push({i, interest, payment, balance});
      }

      const firstPay = principalPart + (sum * r);
      return {rows, totalPaid, firstPay, balances};
    }

    // ---------- chart ----------
    function resizeCanvasToDisplaySize(canvas){
      const rect = canvas.getBoundingClientRect();
      const dpr = window.devicePixelRatio || 1;
      const width = Math.max(300, Math.floor(rect.width));
      const height = 260;
      canvas.width = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      const ctx = canvas.getContext('2d');
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
      return {w: width, h: height};
    }

    function drawChart(seriesA, seriesB){
      if (!chart) return;

      const ctx = chart.getContext('2d');
      const {w, h} = resizeCanvasToDisplaySize(chart);

      ctx.clearRect(0,0,w,h);

      const padL = 36, padR = 12, padT = 10, padB = 24;
      const plotW = w - padL - padR;
      const plotH = h - padT - padB;

      const maxVal = Math.max(...seriesA, ...seriesB, 1);
      const n = Math.max(seriesA.length, seriesB.length);

      // grid
      ctx.strokeStyle = 'rgba(15,23,42,.10)';
      ctx.lineWidth = 1;
      for (let k=0;k<=4;k++){
        const y = padT + (plotH * k / 4);
        ctx.beginPath();
        ctx.moveTo(padL, y);
        ctx.lineTo(padL + plotW, y);
        ctx.stroke();
      }

      // axes
      ctx.strokeStyle = 'rgba(15,23,42,.20)';
      ctx.beginPath();
      ctx.moveTo(padL, padT);
      ctx.lineTo(padL, padT + plotH);
      ctx.lineTo(padL + plotW, padT + plotH);
      ctx.stroke();

      const stepX = plotW / Math.max(1, (n - 1));

      function xy(i, v){
        const x = padL + i * stepX;
        const y = padT + plotH - (v / maxVal) * plotH;
        return {x,y};
      }

      function line(series, color){
        ctx.strokeStyle = color;
        ctx.lineWidth = 3;
        ctx.beginPath();
        series.forEach((v,i)=>{
          const p = xy(i, v);
          if (i===0) ctx.moveTo(p.x,p.y);
          else ctx.lineTo(p.x,p.y);
        });
        ctx.stroke();

        // points (few)
        ctx.fillStyle = color;
        const stepPts = Math.max(1, Math.floor(series.length / 10));
        for (let i=0;i<series.length;i+=stepPts){
          const p = xy(i, series[i]);
          ctx.beginPath();
          ctx.arc(p.x,p.y,3.5,0,Math.PI*2);
          ctx.fill();
        }
      }

      line(seriesA, '#1f5bff');
      line(seriesB, '#16a34a');
    }

    // ---------- main calculate ----------
    function calculate(){
      const sum = Number(sumEl.value);
      const months = Number(monthsEl.value);
      const r = getMonthlyRate();

      if (!sum || !months){
        alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
        return;
      }
      if (sum <= 0 || months <= 0){
        alert('–°—É–º–∞ —ñ —Ç–µ—Ä–º—ñ–Ω –º–∞—é—Ç—å –±—É—Ç–∏ –±—ñ–ª—å—à–µ 0');
        return;
      }

      // warning
      const w = warnByRate(r);
      rateWarning.textContent = w.text;
      rateWarning.style.color = (w.cls === 'danger' ? 'var(--danger)' : w.cls === 'warn' ? 'var(--warn)' : 'var(--ok)');

      // compute both
      const ann = calcAnnuity(sum, months, r);
      const dif = calcDiff(sum, months, r);

      // chart always two lines
      resultBox.style.display = 'block';
      // table shows chosen type
      tbody.innerHTML = '';

      if (tableTypeEl.value === 'annuity'){
        ann.rows.forEach(row => addRow(row.i, row.interest, row.payment, row.balance));
        monthlyOut.textContent = fmt(ann.monthlyPay);
        totalOut.textContent = fmt(ann.totalPaid);
        overpayOut.textContent = fmt(ann.totalPaid - sum);
      } else {
        dif.rows.forEach(row => addRow(row.i, row.interest, row.payment, row.balance));
        monthlyOut.textContent = fmt(dif.firstPay); // show first payment
        totalOut.textContent = fmt(dif.totalPaid);
        overpayOut.textContent = fmt(dif.totalPaid - sum);
      }

      // badges
      const overpayVal = Number(overpayOut.textContent);
      if (overpayVal > sum) setBadge(badgeOver, '‚ö†Ô∏è –ø–µ—Ä–µ–ø–ª–∞—Ç–∞ > —Å—É–º–∏', 'danger');
      else setBadge(badgeOver, 'OK', 'ok');

      if (r >= 0.30) setBadge(badgeTotal, '‚ö†Ô∏è –¥—É–∂–µ –≤–∏—Å–æ–∫–∏–π %', 'danger');
      else if (r >= 0.05) setBadge(badgeTotal, '–≤–∏—Å–æ–∫–∏–π %', 'warn');
      else if (r === 0) setBadge(badgeTotal, '0%', 'ok');
      else setBadge(badgeTotal, '–Ω–æ—Ä–º–∞', 'ok');

      // draw after layout
      setTimeout(() => drawChart(ann.balances, dif.balances), 50);

      // last calc for saving
      window.__lastCalc = {
        id: 'id_' + Math.random().toString(16).slice(2) + '_' + Date.now().toString(16),
        date: nowStr(),
        sum,
        percent: Number(percentEl.value),
        rateType: rateTypeEl.value,
        months,
        tableType: tableTypeEl.value,
        ann_total: ann.totalPaid,
        ann_overpay: ann.totalPaid - sum,
        ann_monthly: ann.monthlyPay,
        diff_total: dif.totalPaid,
        diff_overpay: dif.totalPaid - sum,
        diff_firstPay: dif.firstPay
      };

      resultBox.scrollIntoView({behavior:'smooth', block:'start'});
    }

    // ---------- History / localStorage ----------
    function getSaved(){
      try { return JSON.parse(localStorage.getItem('calculations') || '[]'); }
      catch { return []; }
    }
    function setSaved(arr){
      localStorage.setItem('calculations', JSON.stringify(arr));
    }

    function renderSaved(){
      const saved = getSaved();
      savedList.innerHTML = '';

      if (!saved.length){
        savedList.innerHTML = '<div class="hint">–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤.</div>';
        return;
      }

      saved.slice(0,50).forEach(item=>{
        const div = document.createElement('div');
        div.className = 'savedItem';

        div.innerHTML = `
          <div class="top">
            <div>${item.date}</div>
            <div><b>–°—É–º–∞:</b> ${fmt(item.sum)} –≥—Ä–Ω</div>
          </div>
          <div class="meta">
            %: <b>${item.percent}</b> (${item.rateType === 'year' ? '%/—Ä—ñ–∫' : '%/–º—ñ—Å'}) ¬∑ –ú—ñ—Å—è—Ü—ñ–≤: <b>${item.months}</b><br/>
            –ê–Ω–Ω—É—ó—Ç–µ—Ç: –≤—Å—å–æ–≥–æ <b>${fmt(item.ann_total)}</b> (–ø–µ—Ä–µ–ø–ª–∞—Ç–∞ ${fmt(item.ann_overpay)})<br/>
            –î–∏—Ñ—Ñ: –≤—Å—å–æ–≥–æ <b>${fmt(item.diff_total)}</b> (–ø–µ—Ä–µ–ø–ª–∞—Ç–∞ ${fmt(item.diff_overpay)})
          </div>
          <div class="btns">
            <button class="light" type="button" data-load="${item.id}">‚Ü©Ô∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            <button class="danger" type="button" data-del="${item.id}">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</button>
          </div>
        `;
        savedList.appendChild(div);
      });

      // delegate buttons
      savedList.querySelectorAll('[data-load]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          loadSaved(btn.getAttribute('data-load'));
        });
      });
      savedList.querySelectorAll('[data-del]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          deleteSaved(btn.getAttribute('data-del'));
        });
      });
    }

    function saveCalculation(){
      if (!window.__lastCalc){
        alert('–°–ø–æ—á–∞—Ç–∫—É –∑—Ä–æ–±—ñ—Ç—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫');
        return;
      }
      const saved = getSaved();
      saved.unshift(window.__lastCalc);
      setSaved(saved);
      renderSaved();
      alert('–ó–±–µ—Ä–µ–∂–µ–Ω–æ ‚úî');
    }

    function clearSaved(){
      if (!confirm('–¢–æ—á–Ω–æ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫–∏?')) return;
      localStorage.removeItem('calculations');
      renderSaved();
      alert('–Ü—Å—Ç–æ—Ä—ñ—é –æ—á–∏—â–µ–Ω–æ');
    }

    function toggleSaved(){
      const open = savedBox.style.display === 'block';
      savedBox.style.display = open ? 'none' : 'block';
      if (!open){
        renderSaved();
        savedBox.scrollIntoView({behavior:'smooth', block:'start'});
      }
    }

    function loadSaved(id){
      const saved = getSaved();
      const item = saved.find(x => x.id === id);
      if (!item) return;

      sumEl.value = item.sum;
      percentEl.value = item.percent;
      rateTypeEl.value = item.rateType;
      monthsEl.value = item.months;
      tableTypeEl.value = item.tableType || 'annuity';

      calculate();
    }

    function deleteSaved(id){
      const saved = getSaved().filter(x => x.id !== id);
      setSaved(saved);
      renderSaved();
    }

    function exportSavedCSV(){
      const saved = getSaved();
      if (!saved.length){
        alert('–ù–µ–º–∞—î –∑–±–µ—Ä–µ–∂–µ–Ω–∏—Ö —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—ñ–≤');
        return;
      }
      const headers = [
        'date','sum','percent','rateType','months',
        'ann_total','ann_overpay','ann_monthly',
        'diff_total','diff_overpay','diff_firstPay'
      ];
      const rows = [headers.join(',')];

      saved.forEach(s=>{
        const row = headers.map(h=>{
          const v = s[h];
          const str = String(v ?? '').replace(/"/g,'""');
          return `"${str}"`;
        }).join(',');
        rows.push(row);
      });

      const blob = new Blob([rows.join('\n')], {type:'text/csv;charset=utf-8;'});
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'history-calculations.csv';
      a.click();
      URL.revokeObjectURL(a.href);
    }

    // ---------- Export current ----------
    function exportPDF(){
      if (resultBox.style.display === 'none'){
        alert('–°–ø–æ—á–∞—Ç–∫—É –∑—Ä–æ–±—ñ—Ç—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫');
        return;
      }
      const opt = {
        margin: 10,
        filename: 'kredit-rozrahunok.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(resultBox).save();
    }

    function exportExcel(){
      if (resultBox.style.display === 'none'){
        alert('–°–ø–æ—á–∞—Ç–∫—É –∑—Ä–æ–±—ñ—Ç—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–æ–∫');
        return;
      }

      const wb = XLSX.utils.book_new();

      // sheet: table
      const ws1 = XLSX.utils.table_to_sheet(el('paymentTable'));
      XLSX.utils.book_append_sheet(wb, ws1, '–ì—Ä–∞—Ñ—ñ–∫');

      // sheet: summary
      const summary = [
        ['–î–∞—Ç–∞', nowStr()],
        ['–°—É–º–∞', sumEl.value],
        ['–í—ñ–¥—Å–æ—Ç–æ–∫', percentEl.value],
        ['–ü–µ—Ä—ñ–æ–¥', rateTypeEl.value],
        ['–ú—ñ—Å—è—Ü—ñ–≤', monthsEl.value],
        ['–¢–∞–±–ª–∏—Ü—è', tableTypeEl.value],
        ['–í—Å—å–æ–≥–æ', totalOut.textContent],
        ['–ü–µ—Ä–µ–ø–ª–∞—Ç–∞', overpayOut.textContent],
        ['–ü–ª–∞—Ç—ñ–∂ (–¥–ª—è —Ç–∞–±–ª–∏—Ü—ñ)', monthlyOut.textContent],
      ];
      const ws2 = XLSX.utils.aoa_to_sheet(summary);
      XLSX.utils.book_append_sheet(wb, ws2, '–ü—ñ–¥—Å—É–º–æ–∫');

      XLSX.writeFile(wb, 'kredit-rozrahunok.xlsx');
    }

    
    // ---------- FAQ accordion ----------
    const faqToggle = document.getElementById('faqToggle');
    const faqBody = document.getElementById('faqBody');

    if (faqToggle && faqBody){
      faqToggle.addEventListener('click', ()=>{
        const open = faqBody.style.display === 'block';
        faqBody.style.display = open ? 'none' : 'block';
        faqToggle.innerHTML = open
          ? '‚ùì –ß–∞—Å—Ç—ñ –ø–∏—Ç–∞–Ω–Ω—è –ø—Ä–æ –∫—Ä–µ–¥–∏—Ç'
          : '‚ùå –ó–∞–∫—Ä–∏—Ç–∏ –ø–∏—Ç–∞–Ω–Ω—è';
      });
    }


    // ---------- Clear form ----------
    function clearForm(){
      sumEl.value = '';
      percentEl.value = '';
      monthsEl.value = '';
      rateTypeEl.value = 'month';
      tableTypeEl.value = 'annuity';

      tbody.innerHTML = '';
      totalOut.textContent = '0.00';
      overpayOut.textContent = '0.00';
      monthlyOut.textContent = '0.00';
      rateWarning.textContent = '';
      setBadge(badgeTotal, '', '');
      setBadge(badgeOver, '', '');

      const ctx = chart.getContext('2d');
      const {w,h} = resizeCanvasToDisplaySize(chart);
      ctx.clearRect(0,0,w,h);

      resultBox.style.display = 'none';
      window.__lastCalc = null;
    }

    // ---------- demo ----------
    function fillDemo(){
      sumEl.value = 5555;
      percentEl.value = 55;
      rateTypeEl.value = 'month';
      monthsEl.value = 6;
      tableTypeEl.value = 'annuity';
      calculate();
    }

    // ---------- events ----------
    el('btnCalc').addEventListener('click', calculate);
    el('btnDemo').addEventListener('click', fillDemo);
    el('btnClearForm').addEventListener('click', clearForm);

    el('btnToggleHistory').addEventListener('click', toggleSaved);
    el('btnSave').addEventListener('click', saveCalculation);
    el('btnClearHistory').addEventListener('click', clearSaved);
    el('btnExportHistoryCSV').addEventListener('click', exportSavedCSV);

    el('btnExcel').addEventListener('click', exportExcel);
    el('btnPrint').addEventListener('click', () => window.print());

    // redraw chart on resize (if visible)
    window.addEventListener('resize', ()=>{
      if (resultBox.style.display !== 'none' && window.__lastCalc){
        // recompute quickly and redraw
        const sum = Number(sumEl.value);
        const months = Number(monthsEl.value);
        const r = getMonthlyRate();
        if (sum>0 && months>0){
          const ann = calcAnnuity(sum, months, r);
          const dif = calcDiff(sum, months, r);
          drawChart(ann.balances, dif.balances);
        }
      }
    });
  </script>
</body>
</html>
